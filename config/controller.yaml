control_frequency_hz: 200
sample_time_s: 0.005
command_type: position  # position | velocity
motor_control_mode: torque  # torque | velocity

torque_allocation:
  weight_mode: raw  # torque_utilization | raw

torque_distribution:
  mode: dynamic  # dynamic | fixed
  fixed_weights: [1.0, 1.0]
  fixed_secondary_gain: 1.0

plant:
  inertia: 0.009967215896643318
  damping: 8.172049793342932
  # inertia: 0.0
  # damping: 0.0
  mechanism_matrix: [-20.0, 12.26993865]
  motor_output_gains: [-20.0, 12.26993865]

outer_pid:
  kp: 10.00
  ki: 10.0
  kd: 2.0
  use_feedforward: true
  max_output: 100.0

velocity_pid:
  kp: 0.5
  ki: 0.0
  kd: 0.0
  use_feedforward: false
  max_output: 50.0

per_motor_pid:
  enable_outer_loop: true
  derivative_mode: measurement
  derivative_filter_alpha: 0.05
  motor1:
    kp: 2.81
    ki: 1.0
    kd: 0.1
    max_output: 5.0
  motor2:
    kp: 1.1
    ki: 0.5
    kd: 0.05
    max_output: 0.2

assist_manager:
  enabled: true
  mode: balanced  # balanced: use both motors; threshold: primary-first with activation thresholds
  primary_motor: motor1
  release_start_ratio: 0.5
  release_full_ratio: 0.9
  torque_thresholds:
    activate: 0.6
    deactivate: 0.5
  weighting:
    hold:
      motor1: 1.0
      motor2: 100000.0
    release:
      motor1: 0.1666666667
      motor2: 0.016667
  secondary_gain:
    hold: 0.0
    release: 1.0
  weight_limits:
    w_off: 100000.0
    w_on: 1.0
  time_constant: 0.05

torque_preference:
  mode: balanced  # primary: prefer one motor, balanced: no preference
  preferred_motor: motor1
  secondary_gain: 0.0

torque_limits:
  motor1: 6.0
  motor2: 0.5

torque_rate_limits:
  motor1: 100.0
  motor2: 100.0

velocity_distribution:
  kinematic_matrix: [-0.05, 0.0814285714]
  direct_velocity: false
  output_velocity_limit: 5.0
  output_accel_limit: 20.0
  velocity_limits:
    motor1: 50.0
    motor2: 50.0
  velocity_rate_limits:
    motor1: 100.0
    motor2: 100.0
  use_damping_comp: false
  use_friction_comp: false

friction_ff:
  coulomb: 0.0     # [Nm] output-axis Coulomb friction feedforward
  vel_deadband: 0.02  # [turn/s] use direction hint while nearly stopped
  blend_width: 0.05   # [turn/s] tanh smoothing width outside deadband

freeze:
  motor: None
  kp: 0.1
  kd: 0.002

sign_enforcement:
  enabled: true
  tolerance: 1.0e-3

dob:
  enabled: false
  torque_input_mode: applied  # command | applied
  applied_sign: -1.0           # appliedが不安定なら -1.0 で符号補正
  cutoff_hz: 5.0
  use_damping: false

identification:
  initial_wait: 1.0        # [s] idle before ramp starts
  target_torque: 20.0      # [Nm] desired output torque amplitude
  ramp_duration: 3.0       # [s] 0 -> target ramp time
  hold_duration: 2.0       # [s] hold at target torque
  return_duration: 3.0     # [s] target -> 0 ramp back time
  rest_duration: 2.0       # [s] stay at 0 torque after cycle
  repeat: true             # true to loop the pattern
  motor_freeze: motor2     # motor to keep at 0 torque during experiment
